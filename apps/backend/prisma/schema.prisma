// Prisma Schema for 校园宝 (Campus Treasure)
// MongoDB Database - Prisma 7

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
}

// ============= 用户模型 =============
model User {
  id           String  @id @default(auto()) @map("_id") @db.ObjectId
  phone        String  @unique
  passwordHash String?
  nickname     String
  avatar       String?
  school       String?

  // 关联
  items    Item[]
  orders   Order[]   @relation("BuyerOrders")
  messages Message[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============= 物品模型 =============
model Item {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  price       Float
  images      String[]
  condition   String // 全新, 9成新, 8成新...
  category    String
  status      String   @default("available") // available, sold, removed

  sellerId String @db.ObjectId
  seller   User   @relation(fields: [sellerId], references: [id])

  orders Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sellerId])
  @@index([category])
  @@index([status])
}

// ============= 订单模型 =============
model Order {
  id      String @id @default(auto()) @map("_id") @db.ObjectId
  itemId  String @db.ObjectId
  item    Item   @relation(fields: [itemId], references: [id])
  buyerId String @db.ObjectId
  buyer   User   @relation("BuyerOrders", fields: [buyerId], references: [id])
  amount  Float
  status  String @default("pending") // pending, paid, shipped, completed, cancelled

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([buyerId])
  @@index([status])
}

// ============= 消息模型 =============
model Message {
  id         String  @id @default(auto()) @map("_id") @db.ObjectId
  senderId   String  @db.ObjectId
  sender     User    @relation(fields: [senderId], references: [id])
  receiverId String
  content    String
  type       String  @default("text") // text, image
  isRead     Boolean @default(false)

  createdAt DateTime @default(now())

  @@index([senderId])
  @@index([receiverId])
}
